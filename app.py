import streamlit as st
import random

def calculate_light_score(stress, focus, calm, poem):
    # ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’ä¿®æ­£
    # ã‚¹ãƒˆãƒ¬ã‚¹ã‚’é€†è»¢ã•ã›ã¦ã€3ã¤ã®å¹³å‡ã‚’å–ã‚‹æ–¹å¼ã«å¤‰æ›´
    reversed_stress = 5 - stress  # ã‚¹ãƒˆãƒ¬ã‚¹ã‚’åè»¢ï¼ˆé«˜ã„ã»ã©è‰¯ã„çŠ¶æ…‹ã«ï¼‰
    raw_score = (reversed_stress + focus + calm) / 3
    score = round(max(1, min(5, raw_score)), 2)
    
    # ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
    if score >= 4.0:
        advice = "ç´ æ™´ã‚‰ã—ã„ï¼ä»Šæ—¥ã®ã‚ãªãŸã¯å…‰ã‚Šè¼ã„ã¦ã„ã¾ã™ã€‚ãã®ã¾ã¾ã®ã‚ãªãŸã§é€²ã‚“ã§ãã ã•ã„ã€‚"
        celebration = True
    elif score >= 2.5:
        advice = "ã¾ãšã¾ãšã®èª¿å­ã§ã™ã€‚å°‘ã—ã ã‘è‡ªåˆ†ã®ãŸã‚ã®æ™‚é–“ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
        celebration = False
    else:
        # ä½ã‚¹ã‚³ã‚¢æ™‚ã®ãŠã¾ã˜ãªã„ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
        advices = [
            "ã€ãŠã¾ã˜ãªã„ã€‘æ·±å‘¼å¸ã—ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã€‚ã‚†ã£ãã‚Šæ¯ã‚’åã„ã¦ã¿ã¦ã€‚",
            "ã€ãŠã¾ã˜ãªã„ã€‘è‡ªåˆ†ã®å¥½ããªé£Ÿã¹ç‰©ã‚„éŸ³æ¥½ãªã©ã€å¥½ããªã‚‚ã®ã‚’ä½•ã§ã‚‚ã„ã„ã‹ã‚‰èº«ã«ã¤ã‘ã¦ï¼ˆå–ã‚Šå…¥ã‚Œã¦ï¼‰ã¿ã¦ã€‚",
            "ã€ãŠã¾ã˜ãªã„ã€‘é­”æ³•ã®è¨€è‘‰ã ã‚ˆã€‚ã€Œå¤§ä¸ˆå¤«ã€ã€‚å£°ã«å‡ºã—ã¦ã¿ã¦ã€‚",
            "ã€ãŠã¾ã˜ãªã„ã€‘ç­”ãˆã‚’å‡ºã—ã¦ã‚‚å‡ºã•ãªãã¦ã‚‚ã„ã„ã‚ˆã€‚",
ã€€ã€€ã€€ã€€ã€€ã€€ã€€"ã€ãŠã¾ã˜ãªã„ã€‘ç”Ÿãã¦ã„ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€€ãã‚Œã ã‘ã§ååˆ†ã€‚" ,     
ã€€ã€€ã€€ã€€ã€€   "ã€ãŠã¾ã˜ãªã„ã€‘ãµã…ãƒ¼ã£ã¨ä¸€æ¯ã¤ã„ã¦ã€ç©ºã‚’è¦‹ä¸Šã’ã¦ã”ã‚‰ã‚“ã€‚"
        ]
        advice = random.choice(advices)
        celebration = False
    
    # è©©ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãŸã‚‰è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    if len(poem.strip()) > 0:
        advice += f"\n\nâœ¨ è©©ã®ä¸­ã«å…‰ãŒå®¿ã£ã¦ã„ã¾ã™ã€‚ã€Œ{poem[:15]}â€¦ã€ã‚’èƒ¸ã®ä¸­å¿ƒã§å‘³ã‚ã£ã¦ãã ã•ã„ã€‚"
    
    return score, advice, celebration

# ã‚¢ãƒ—ãƒªUI
st.set_page_config(page_title="å…‰ã‚¹ã‚³ã‚¢è¨ºæ–­ã‚¢ãƒ—ãƒª", page_icon="âœ¨", layout="centered")
st.title("âœ¨ å…‰ã‚¹ã‚³ã‚¢è¨ºæ–­ã‚¢ãƒ—ãƒª")
st.write('ã‚¹ãƒˆãƒ¬ã‚¹ãƒ»é›†ä¸­ãƒ»é™ã‘ã•ãƒ»è©©ã‹ã‚‰ã€ä»Šæ—¥ã®"å…‰ã®åº¦åˆã„"ã‚’ç®—å‡ºã—ã¾ã™')

st.subheader("â–  ä»Šæ—¥ã®çŠ¶æ…‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
stress = st.slider("ã‚¹ãƒˆãƒ¬ã‚¹ï¼ˆ0ã€œ5ï¼‰", 0, 5, 2)
focus = st.slider("é›†ä¸­ï¼ˆ0ã€œ5ï¼‰", 0, 5, 3)
calm = st.slider("é™ã‘ã•ï¼ˆ0ã€œ5ï¼‰", 0, 5, 3)
poem = st.text_area("ä»Šæ—¥ã®è©©ã€ã¾ãŸã¯æ„Ÿã˜ãŸè¨€è‘‰ï¼ˆä»»æ„ï¼‰", "")

if st.button("âœ¨ å…‰ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã™ã‚‹"):
    score, advice, celebration = calculate_light_score(stress, focus, calm, poem)
    
    if celebration:
        st.balloons()
    
    st.subheader("â–  è¨ºæ–­çµæœ")
    st.write(f"ä»Šæ—¥ã®å…‰ã‚¹ã‚³ã‚¢ï¼š **{score} / 5.0**")
    
    st.info(f"ğŸ’¡ ä»Šæ—¥ã®ã‚ãªãŸã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š\n\n {advice}")
    
    st.write("---")
    st.caption("Powered by Singularity Education")







